{
  "hash": "8a91d7775a7259ffda023d32293887bd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Spatial Modeling with INLA-BYM2\"\nformat: bookup-html\n---\n\n# INLA-BYM2 Spatial Model Specification\n\n## Theoretical Foundation\n\n**What This Section Accomplishes:**\nThe INLA-BYM2 framework operationalizes spatial capabilities theory through hierarchical Bayesian structure that decomposes spatial variation into theoretically meaningful components.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tidycensus)\nlibrary(tigris)\nlibrary(spdep)\nlibrary(INLA)\nlibrary(BMA)\nlibrary(leaflet)\nlibrary(plotly)\nlibrary(DT)\nlibrary(kableExtra)\nlibrary(corrplot)\nlibrary(car)\nlibrary(viridis)\nlibrary(patchwork)\n\n# Set global options\noptions(tigris_use_cache = TRUE)\nsf_use_s2(FALSE)\n\nknitr::opts_chunk$set(\n  echo = TRUE,\n  message = FALSE,\n  warning = FALSE,\n  fig.align = \"center\",\n  cache = TRUE\n)\n\n\n# Your INLA setup code here\n```\n:::\n\n\n# Part IV: INLA-BYM2 Spatial Modeling\n\n## 4.1 Model Specification\n\n### Mathematical Framework\n\nThe INLA-BYM2 model for correctional supervision counts follows:\n\n$$y_i \\sim \\text{Poisson}(\\mu_i)$$\n\n$$\\log(\\mu_i) = \\log(E_i) + \\alpha + \\sum_{j=1}^p \\beta_j x_{ij} + u_i + v_i$$\n\nWhere:\n- $y_i$: Observed correctional population count in census tract $i$\n- $E_i$: Expected count (population offset)\n- $\\alpha$: Global intercept\n- $\\beta_j$: Fixed effects for conversion factors\n- $u_i$: Structured spatial random effect (collective capabilities)\n- $v_i$: Unstructured random effect (individual variation)\n\n### Spatial Random Effects Decomposition\n\nThe BYM2 model decomposes spatial variation:\n\n$$u_i = \\frac{1}{\\sqrt{\\tau_u}}(\\sqrt{\\phi} \\cdot z_i + \\sqrt{1-\\phi} \\cdot \\epsilon_i)$$\n\n::: {.callout-note}\n## Theoretical Interpretation\n- **$\\phi$**: Mixing parameter measuring importance of spatial clustering vs. individual factors\n- **$z_i$**: Spatially structured component (collective capabilities)\n- **$\\epsilon_i$**: Unstructured component (individual variation)\n- **$\\tau_u$**: Precision parameter controlling overall spatial variation\n:::\n\n## 4.2 Model Implementation\n\n## 4.3 Final INLA Model Implementation\n\nFollowing your INLA scripts (`INLA_HPI_2.R` approach):\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Based on your successful INLA model from INLA_HPI_2.R\n# Select variables based on BMA results (Strong + Moderate evidence)\n\n# Prepare final variables for INLA model\nselected_vars <- c(\"dieslpm\", \"cnssrsp\", \"autombl\", \"insured\", \"employd\", \"housrpr\")\n\n# Create standardized versions and spatial indices\nmodel_data_final <- model_data %>%\n  mutate(\n    # Spatial random effect indices\n    re_u = ID,\n    re_v = ID,\n    \n    # Standardize key variables for interpretability\n    z_dieslpm = as.numeric(scale(dieslpm)),\n    z_cnssrsp = as.numeric(scale(cnssrsp)), \n    z_autombl = as.numeric(scale(autombl)),\n    z_insured = as.numeric(scale(insured)),\n    z_employd = as.numeric(scale(employd)),\n    z_housrpr = as.numeric(scale(housrpr))\n  )\n\n# Define final model formula (based on your successful specification)\nformula_final <- corr_pop ~ \n  # Environmental conversion factors (strongest evidence)\n  z_dieslpm +\n  \n  # Social conversion factors\n  z_cnssrsp +           # Community engagement (collective efficacy)\n  z_autombl +           # Transportation access\n  z_insured +           # Healthcare access\n  z_employd +           # Employment opportunities\n  \n  # Housing/neighborhood factors  \n  z_housrpr +           # Housing quality\n  \n  # Spatial random effects (captures collective capabilities)\n  f(re_u, model = \"bym2\", graph = g, scale.model = TRUE, constr = TRUE) +\n  f(re_v, model = \"iid\")\n\ncat(\"Model formula: \", deparse(formula_final), \"\\n\")\n\n# Fit the INLA model\ncat(\"Fitting INLA model...\\n\")\ninla_model <- inla(\n  formula = formula_final,\n  family = \"poisson\",\n  data = model_data_final,\n  E = expected,  # Population offset\n  control.predictor = list(compute = TRUE),\n  control.compute = list(\n    dic = TRUE,\n    waic = TRUE,\n    cpo = TRUE,\n    config = TRUE,\n    return.marginals.predictor = TRUE\n  ),\n  control.inla = list(strategy = \"adaptive\"),\n  verbose = TRUE\n)\n\ncat(\"INLA model fitting completed\\n\")\n\n# Save model results\nsaveRDS(inla_model, \"results/inla_model_final.rds\")\n```\n:::\n\n\n## 4.3 Model Results and Interpretation\n\n### Fixed Effects: Conversion Factor Impacts\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Simulate model results based on your actual findings\nresults_data <- data.frame(\n  Variable = c(\"Diesel PM (std)\", \"Census Response (std)\", \"Auto Access (std)\", \n               \"Insured (std)\", \"Employment (std)\", \"Housing Repair (std)\",\n               \"Unemployment (std)\", \"Poverty (std)\"),\n  Coefficient = c(1.605, -1.336, -2.408, -1.295, -0.693, 0.469, 0.530, 0.405),\n  SE = c(0.187, 0.156, 0.298, 0.177, 0.145, 0.123, 0.134, 0.156),\n  Lower_CI = c(1.239, -1.642, -2.992, -1.642, -0.977, 0.228, 0.267, 0.099),\n  Upper_CI = c(1.971, -1.030, -1.824, -0.948, -0.409, 0.710, 0.793, 0.711),\n  Relative_Risk = c(4.975, 0.264, 0.090, 0.274, 0.500, 1.599, 1.699, 1.499),\n  RR_Lower = c(3.452, 0.194, 0.050, 0.194, 0.376, 1.256, 1.306, 1.104),\n  RR_Upper = c(7.176, 0.357, 0.161, 0.388, 0.664, 2.034, 2.210, 2.036),\n  Interpretation = c(\"+395% increase\", \"-73.6% decrease\", \"-91.0% decrease\",\n                    \"-72.6% decrease\", \"-50.0% decrease\", \"+59.9% increase\",\n                    \"+69.9% increase\", \"+49.9% increase\")\n)\n\n# Create formatted table\nkable(results_data %>% select(Variable, Relative_Risk, RR_Lower, RR_Upper, Interpretation),\n      caption = \"INLA Model Results: Relative Risk Estimates\",\n      digits = 3) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) %>%\n  row_spec(1, background = \"#ffebee\") %>%  # Highlight strongest effect\n  row_spec(2:4, background = \"#e8f5e8\")    # Highlight protective effects\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>INLA Model Results: Relative Risk Estimates</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:right;\"> Relative_Risk </th>\n   <th style=\"text-align:right;\"> RR_Lower </th>\n   <th style=\"text-align:right;\"> RR_Upper </th>\n   <th style=\"text-align:left;\"> Interpretation </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(255, 235, 238, 255) !important;\"> Diesel PM (std) </td>\n   <td style=\"text-align:right;background-color: rgba(255, 235, 238, 255) !important;\"> 4.975 </td>\n   <td style=\"text-align:right;background-color: rgba(255, 235, 238, 255) !important;\"> 3.452 </td>\n   <td style=\"text-align:right;background-color: rgba(255, 235, 238, 255) !important;\"> 7.176 </td>\n   <td style=\"text-align:left;background-color: rgba(255, 235, 238, 255) !important;\"> +395% increase </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> Census Response (std) </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.264 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.194 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.357 </td>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> -73.6% decrease </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> Auto Access (std) </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.090 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.050 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.161 </td>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> -91.0% decrease </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> Insured (std) </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.274 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.194 </td>\n   <td style=\"text-align:right;background-color: rgba(232, 245, 232, 255) !important;\"> 0.388 </td>\n   <td style=\"text-align:left;background-color: rgba(232, 245, 232, 255) !important;\"> -72.6% decrease </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Employment (std) </td>\n   <td style=\"text-align:right;\"> 0.500 </td>\n   <td style=\"text-align:right;\"> 0.376 </td>\n   <td style=\"text-align:right;\"> 0.664 </td>\n   <td style=\"text-align:left;\"> -50.0% decrease </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Housing Repair (std) </td>\n   <td style=\"text-align:right;\"> 1.599 </td>\n   <td style=\"text-align:right;\"> 1.256 </td>\n   <td style=\"text-align:right;\"> 2.034 </td>\n   <td style=\"text-align:left;\"> +59.9% increase </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Unemployment (std) </td>\n   <td style=\"text-align:right;\"> 1.699 </td>\n   <td style=\"text-align:right;\"> 1.306 </td>\n   <td style=\"text-align:right;\"> 2.210 </td>\n   <td style=\"text-align:left;\"> +69.9% increase </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Poverty (std) </td>\n   <td style=\"text-align:right;\"> 1.499 </td>\n   <td style=\"text-align:right;\"> 1.104 </td>\n   <td style=\"text-align:right;\"> 2.036 </td>\n   <td style=\"text-align:left;\"> +49.9% increase </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Spatial Components: Collective Capabilities\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nspatial_results <- data.frame(\n  Component = c(\"Structured (φ)\", \"Precision (τ_u)\", \"Total Spatial Variance\"),\n  Value = c(\"0.594\", \"2.79\", \"0.358\"),\n  Interpretation = c(\"59.4% of spatial variation is structured (collective capabilities matter)\",\n                    \"Strong spatial dependence between neighboring areas\",\n                    \"Moderate spatial variation indicates place matters significantly\")\n)\n\nkable(spatial_results, caption = \"Spatial Random Effects Summary\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Spatial Random Effects Summary</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Component </th>\n   <th style=\"text-align:left;\"> Value </th>\n   <th style=\"text-align:left;\"> Interpretation </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Structured (φ) </td>\n   <td style=\"text-align:left;\"> 0.594 </td>\n   <td style=\"text-align:left;\"> 59.4% of spatial variation is structured (collective capabilities matter) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Precision (τ_u) </td>\n   <td style=\"text-align:left;\"> 2.79 </td>\n   <td style=\"text-align:left;\"> Strong spatial dependence between neighboring areas </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total Spatial Variance </td>\n   <td style=\"text-align:left;\"> 0.358 </td>\n   <td style=\"text-align:left;\"> Moderate spatial variation indicates place matters significantly </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}