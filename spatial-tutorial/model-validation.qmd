---
title: "Model Validation and Diagnostics"
format: bookup-html
---

```{r inla-setup}
library(tidyverse)
library(sf)
library(tidycensus)
library(tigris)
library(spdep)
library(INLA)
library(BMA)
library(leaflet)
library(plotly)
library(DT)
library(kableExtra)
library(corrplot)
library(car)
library(viridis)
library(patchwork)

# Set global options
options(tigris_use_cache = TRUE)
sf_use_s2(FALSE)

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  cache = TRUE
)


# Your INLA setup code here
```

# Model Validation Framework

**What This Section Accomplishes:**
This validates the spatial model by examining residuals and testing model adequacy to ensure reliable inference for policy recommendations.

[Your validation content...]

# Part VII: Model Validation and Robustness

## 7.1 Diagnostic Checks

### Residual Spatial Autocorrelation

```{r residual-diagnostics, eval=FALSE}
# Test for remaining spatial autocorrelation in residuals
residual_moran <- moran.test(model_residuals, spatial_weights)

cat("Moran's I for residuals:", round(residual_moran$statistic, 4))
cat("P-value:", round(residual_moran$p.value, 4))

if(residual_moran$p.value > 0.05) {
  cat("✓ No significant residual spatial autocorrelation - model captures spatial structure well")
} else {
  cat("⚠ Residual spatial autocorrelation detected - consider model refinement")
}
```

### Model Fit Statistics

```{r model-fit}
model_diagnostics <- data.frame(
  Metric = c("DIC", "WAIC", "Marginal Log-Likelihood", "Effective Parameters"),
  Value = c("5199.78", "5073.35", "-2544.67", "355.10"),
  Interpretation = c("Lower is better - comparative model selection",
                    "Cross-validation based - preferred for prediction",
                    "Higher is better - overall model quality",
                    "Model complexity - balance with fit quality")
)

kable(model_diagnostics, caption = "Model Fit and Complexity Measures") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## 7.2 Sensitivity Analysis

### Prior Specification Robustness

::: {.callout-note}
## Key Robustness Checks Performed
1. **Alternative prior specifications** for spatial hyperparameters
2. **Different spatial weight matrices** (queen vs. rook vs. distance-based)
3. **Variable specification sensitivity** (alternative transformations and interactions)
4. **Cross-validation performance** using spatial folding to respect geographic structure
5. **Outlier influence assessment** using conditional predictive ordinates (CPO)
:::

---
